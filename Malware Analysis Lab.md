
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>Malware Analysis Lab</h1>
    
  <h2>Static Analysis:</h2>
  
  <h3>Floss Analysis:</h3>
    <ul>
        <li>In the first part of the lab, I will use static analysis to learn about a malware sample. The believed malware “sample1.exe” is prepared for analysis and the folder “Malware Analysis” contains all 
            of the malware analysis tools that I will be using. The first tool will be Floss.</li>
            <img src="MWAImages/MA1.png" width="750">
        <li>Now I will open the command prompt window to run Floss on  “sample1.exe”. Once Floss is done processing the file I can scroll back up to identify strings with potential malicious behavior, reveal patterns                indicative of obfuscation and malicious intent.</li>
        <img src="MWAImages/MA2.png" width="750">
        <li>Notable findings include the ability to create new admin users, evidence of development in VS code, registry modification capabilities, and functionalities consistent with ransomware and crypto-mining.</li>
<body>
    <div style="display: flex;">
        <img src="MWAImages/MA4.png" style="width: 70%; height: auto;">
        <img src="MWAImages/MA5.png" style="width: 70%; height: auto;">
    </div>
    <div style="display: flex;">
        <img src="MWAImages/MA6.png" style="width: 70%; height: auto;">
        <img src="MWAImages/MA7.png" style="width: 70%; height: auto;">
    </div>
    <div style="display: flex;">
        <img src="MWAImages/MA8.png" style="width: 70%; height: auto;">
    </div>
</body>
        <li>Other nefarious actions:</li>
        <li>Clear evidence of ransomware:</li>
      </ul>

   <h3>Ghidra Analysis:</h3>
    <ul>
        <li>For the next Static Analysis I will be using Ghidra, a software reverse engineering suite of tools to look at sample1.exe. I will run Ghidra, start a new project, and import the sample1.exe file. 
        When the import is finished a Results Summary will appear.</li>
        <li>Here in the Results Summary page we can see Portable Execution (PE) properties for the sample1 executable providing insights into the executable's nature and origin.</li>
        <li>Next I will use the Ghidra CodeBrowser tool to analyze sample1.exe. Ghidra CodeBrowser analyzes the binary code, uncovering potential malware functions and behaviors, such as the presence of "killrdp" function.
        we can see a Symbol tree on the left with quite a bit of obfuscation again as well as a function called killrdp. Right clicking killrdp and clicking Make Selection will highlight it in the Listing window. 
        This information can be useful to a malware analyst that has a strong background in assembly to learn how this program works.</li>
    </ul>

   <h3>PEStudio Analysis:</h3>
    <ul>
        <li>PEStudio is the last Static Analysis tool I will be using to perform static analysis on "sample1.exe”. Opening the file in PEStudio unveils crucial metadata including md5, sha1, and sha256 hashes. 
            If this was the only information I had I could run these against known hashes online.</li>
        <li>In the left pane, click the indicators (file > embedded) line to see the corresponding details. In the right pane there are actually 5 other programs embedded in this sample. 
            It's possible for non-malicious code to have embedded executables, but typically this is a common practice of malware developers.</li>
        <li>In the left pane, clicking the imports (flag) line to see the corresponding details in the right pane. These are all the Windows API functions called by the malware sample. 
            We can get an idea of what this malware sample likely does by looking at the API calls it makes. 
            There are also associated MITRE ATT&CK techniques for some API calls.</li>
    
  <h3>API Calls Made by the Sample:</h3>
        <li><strong>Download files (Network)</strong> - MITRE technique T1086 | Powershell</li>
        <li><strong>Sleep (Execution)</strong> - MITRE technique T1479 | Sandbox Evasion</li>
        <li><strong>MemoryStream (Memory)</strong> - MITRE technique T1055 | Process Injection</li>
        <li><strong>GetCurrentProcess (Execution)</strong> - MITRE technique T1057 | Process Discovery</li>
    </ul>
    
  <h2>Dynamic Analysis:</h2>

  <h3>Toolset Preparation:</h3>
    <ul>
        <li>So far, we have used static analysis to determine how the malware sample will likely behave when run. There is much more to glean using static analysis, but in this next part, we will ready our dynamic toolset and detonate the sample. 
            Note that you should only detonate malware samples in the cloud (in an isolated VPC) or in an isolated home network with simulated Internet. Some malware is hypervisor-aware and may try to break free and infect the host system. Caution should always be used when analyzing potential malware.
        </li>
        <li>We will open tcpview64, Process Hacker 2, and Procmon64 from the Malware Analysis folder and position to see them all on the screen.</li>
        <li>TCPView will show if the malware tries to make any network connections. Process Hacker will show us that the malware is running and if it spawns other processes. Process Monitor will act as our flight recorder. 
            It will track any change made to the registry, files, network, etc. We will save everything the Process Monitor collects and feed that into a visualization tool (ProcDOT) later.
        </li>
    </ul>

  <h3>Malware Detonation:</h3>
    <ul>
        <li>Now we will detonate the malware. We can see in TCPView that sample1.exe is making a remote connection. After letting it run for a few minutes then I will terminate the sample1.exe process with Process Hacker.</li>
        <li>In Process Monitor we can filter sample1.exe by Process Name to see all events related to sample1.exe that were recorded and lastly save the file as a Comma Separated Values (CSV) to open it in ProcDOT.</li>
    </ul>

  <h3>ProcDOT Visualization:</h3>
    <ul>
        <li> After opening ProcDOT in the Monitoring Logs field we will open the Logfile.CSV file that was saved from Process Monitor, and in the Render Configuration field select sample1.exe process. After hitting Refresh ProcDOT will generate a graph of all actions taken by sample1.exe recorded by Process Monitor. 
            We can see after detonating the malware it made two network connections, then spawned a new thread, which in turn made many registry changes.
        </li>
        <li>ProcDOT's comprehensive graph illustrats the actions performed by "sample1.exe," facilitating deeper insights into its behavior and potential impact.</li>
    </ul>

  <h2>Conclusion:</h2>
    <p>The Malware Analysis Lab combines static and dynamic analysis techniques to dissect and understand the behavior of suspected malware samples. Through meticulous examination of metadata, code, and runtime activities, valuable insights are gained into the nature, origin, and potential threat posed by malicious executables.</p>
</body>
</html>
